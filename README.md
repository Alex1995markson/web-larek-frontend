# Проектная работа "Веб-ларек"

> Данный документ представляет структурированное и формализованное описание компонентов, типов данных и взаимодействий приложения, реализованного по парадигме **MVP**.

---

## Оглавление
- [Краткое описание](#краткое-описание)
- [Данные и типы данных](#данные-и-типы-данных)
  - [Карточка](#карточка)
  - [Форма](#форма)
  - [Интерфейс модели карточек](#интерфейс-модели-карточек)
  - [Корзина товаров](#корзина-товаров)
  - [Интерфейс оформления покупки](#интерфейс-оформления-покупки)
  - [Типы данных (алиасы)](#типы-данных-алиасы)
- [Архитектура приложения](#архитектура-приложения)
- [Базовая инфраструктура](#базовая-инфраструктура)
  - [Класс Api](#класс-api)
  - [Класс EventEmitter](#класс-eventemitter)
- [Слой данных](#слой-данных)
  - [Класс CardsData](#класс-cardsdata)
  - [Класс BasketData](#класс-basketdata)
  - [Класс UserData](#класс-userdata)
- [Слой представления](#слой-представления)
  - [Класс Modal](#класс-modal)
  - [Класс ModalWithOrder](#класс-modalwithorder)
  - [Класс ModalWithContacts](#класс-modalwithcontacts)
  - [Класс ModalWithCard](#класс-modalwithcard)
  - [Класс ModalWithConfirm](#класс-modalwithconfirm)
  - [Класс Card](#класс-card)
  - [Класс CardsContainer](#класс-cardscontainer)
  - [Класс Basket](#класс-basket)
  - [Класс BasketPreview](#класс-basketpreview)
- [Слой коммуникации](#слой-коммуникации)
  - [Класс AppApi](#класс-appapi)
- [Взаимодействие компонентов](#взаимодействие-компонентов)
- [Событийная модель](#событийная-модель)
  - [События изменения данных](#события-изменения-данных)
  - [События пользовательского интерфейса](#события-пользовательского-интерфейса)

---

## Краткое описание

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

### Карточка

```ts
export interface ICard {
  _id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

### Форма

```ts
export interface IForm {
  payment: string;
  email: string;
  phone: string;
  address: string;
}
```

### Интерфейс модели карточек

```ts
export interface ICardsData {
  cards: ICard[];
  preview: string | null;
  getCard(cardId: string): ICard;
}
```

### Корзина товаров

```ts
export interface IBasketData {
  total: number;
  items: ICard[];
  addCard(card: ICard): void;
  deleteCard(cardId: string): void;
  clearBuscket(data: Record<keyof TCardBasket, string>): void;
  getList(): ICard[];
}
```

> **Примечание:** Имена методов и полей приведены в исходном виде, включая возможные орфографические особенности (например, `clearBuscket`).

### Интерфейс оформления покупки

```ts
export interface IUserData {
  setUserInfo(): TPayment;
  setUserContacts(): TContacts;
  clearData(): void;
}
```

### Типы данных (алиасы)

```ts
// Данные карточки, используемые в корзине
export type TCardBasket = Pick<ICard, 'title' | 'price'>;

// Данные формы для оплаты
export type TPayment = Pick<IForm, 'payment' | 'address'>;

// Данные формы с контактами
export type TContacts = Pick<IForm, 'email' | 'phone'>;

// Данные корзины с общей суммой покупки
export type TPurchase = Pick<IBasketData, 'total'>;
```

---

## Архитектура приложения

Приложение реализовано по парадигме **Model–View–Presenter (MVP)** с разграничением ответственности на три слоя:

- **Слой представления (View):** отвечает за визуализацию данных и обработку пользовательских действий на уровне UI.
- **Слой данных (Model):** обеспечивает хранение, валидацию и изменение данных.
- **Презентер (Presenter):** координирует обмен информацией между слоем представления и слоем данных, управляет реакцией на события.

---

## Базовая инфраструктура

### Класс Api

Класс инкапсулирует базовую логику сетевого взаимодействия.

- **Конструктор:** принимает базовый URL сервера и необязательный объект HTTP-заголовков.
- **Методы:**
  - `get(endpoint: string)` — выполняет HTTP‑запрос `GET` и возвращает промис с ответом.
  - `post(endpoint: string, data: object, method?: string)` — отправляет данные в формате JSON. По умолчанию используется `POST`; метод может быть переопределён третьим параметром.

### Класс EventEmitter

Класс реализует брокер событий для подписки и публикации событий в пределах системы. Применяется в презентере и слоях приложения.

Интерфейс `IEvents` предусматривает следующие методы:

- `on` — подписка на событие;
- `emit` — публикация (инициация) события;
- `trigger` — возвращает функцию, вызывающую указанное событие.

---

## Слой данных

### Класс CardsData

Отвечает за хранение и доменную логику карточек товаров.

- **Конструктор:** принимает экземпляр брокера событий.
- **Поля:**
  - `_cards: ICard[]` — коллекция карточек;
  - `_preview: string | null` — идентификатор карточки, выбранной для предварительного просмотра в модальном окне;
  - `events: IEvents` — экземпляр `EventEmitter`.
- **Методы:**
  - `getCard(cardId: string): ICard` — возвращает карточку по идентификатору;
  - геттеры/сеттеры для управления `_cards` и `_preview`.

### Класс BasketData

Инкапсулирует состояние и операции с корзиной.

- **Конструктор:** принимает экземпляр брокера событий.
- **Поля и методы:**
  - `total: number` — суммарная стоимость заказа;
  - `_cards: ICard[]` — список карточек в корзине;
  - `addCard(card: ICard): void` — добавляет товар и инициирует событие изменения;
  - `deleteCard(cardId: string): void` — удаляет товар по идентификатору;
  - `clearBuscket(): void` — очищает корзину;
  - `getList(): ICard[]` — возвращает текущий список товаров;
  - `events: IEvents` — экземпляр `EventEmitter`.

### Класс UserData

Обеспечивает хранение и обработку контактных и платёжных данных пользователя.

- **Конструктор:** принимает экземпляр брокера событий.
- **Поля и методы:**
  - `payment: string` — способ оплаты;
  - `adress: string` — адрес пользователя;
  - `email: string` — электронная почта;
  - `phone: string` — номер телефона;
  - `setValid(isValid: boolean): void` — устанавливает флаг валидности данных;
  - `setUserInfo(userData: IForm): TPayment` — сохраняет способ оплаты и адрес;
  - `setUserContacts(userData: IForm): TContacts` — сохраняет контактные данные;
  - `clearData(): void` — сбрасывает сохранённые данные;
  - `events: IEvents` — экземпляр `EventEmitter`.

---

## Слой представления

Классы представления отвечают за отображение данных в переданном контейнере DOM и генерацию событий при пользовательском взаимодействии.

### Класс Modal

Реализует базовое модальное окно с произвольным HTML‑контентом.

- **Методы:** `open`, `close`.
- **Слушатели:** закрытие по клавише `Esc`, клику по оверлею и кнопке‑крестику.

### Класс ModalWithOrder

Модальное окно с формой, содержащей чекбокс и поле ввода.

- При изменении значений инициирует событие о модификации данных.
- Предоставляет управление активностью кнопки подтверждения.

**Поля:**

- `submitButton: HTMLButtonElement`
- `_form: HTMLFormElement`
- `formName: string`
- `inputs: NodeListOf`

**Методы:**

- `setValid(isValid: boolean): void`
- `setInputValues(data: Record<string, string>): void`
- `close(): void` — очищает поля и деактивирует кнопку
- `render(): HTMLElement`

### Класс ModalWithContacts

Модальное окно с формой для ввода контактных данных.

- При сабмите публикует событие с агрегированными данными формы.
- При изменениях в полях публикует событие об изменении данных.
- Управляет активностью кнопки подтверждения.

**Поля:**

- `submitButton: HTMLButtonElement`
- `_form: HTMLFormElement`
- `formName: string`
- `inputs: NodeListOf`

**Методы:**

- `setValid(isValid: boolean): void`
- `setInputValues(data: Record<string, string>): void`
- `close(): void`
- `render(): HTMLElement`

### Класс ModalWithCard

Модальное окно для детального просмотра карточки товара.

**Поля:**

- `cardId: string`
- `cardImage: HTMLImageElement`
- `cardDescription: HTMLImageElement`
- `cardTitle: HTMLImageElement`
- `cardCategory: HTMLImageElement`
- `cardPrice: HTMLImageElement`

**Методы:**

- `render(): HTMLElement`

### Класс ModalWithConfirm

Модальное окно подтверждения завершения покупки.

**Поля:**

- `submitButton: HTMLButtonElement`
- `_form: HTMLFormElement`
- `formName: string`
- `handleSubmit: Function` — обработчик покупки, выполняемый при сабмите (включая закрытие окна)

**Методы:**

- `open(handleSubmit: Function): void` — регистрирует обработчик подтверждения
- `render(): HTMLElement`

### Класс Card

Представление карточки товара с отображением названия, изображения, описания, категории и цены.

- Конструктор принимает DOM‑шаблон и `EventEmitter`.
- Устанавливает обработчики для всех интерактивных элементов.

**Методы:**

- `setData(cardData: ICard): void`
- `render(): HTMLElement`
- `get id(): string` — уникальный идентификатор карточки

### Класс CardsContainer

Компонент‑контейнер для размещения карточек на главной странице.

- Конструктор принимает DOM‑контейнер.
- Предоставляет сеттер массива HTML‑элементов для полного перерендеринга содержимого.

### Класс Basket

Компонент отображения корзины: перечень товаров, итоговая сумма и счётчик количества.

- Устанавливает обработчики интерактивных элементов.

**Поля:**

- `handleButtom: HTMLButtonElement`
- `total: string`
- `cardsContainer: HTMLElement`

**Методы:**

- `setData(cardElements: HTMLElement[]): void`
- `deleteCard(cardId: string): void`

### Класс BasketPreview

Мини‑компонент для отображения сведений о корзине на главной странице.

**Поля и методы:**

- `totalCards: number` — количество товаров
- `open(): void` — открывает модальное окно корзины

---

## Слой коммуникации

### Класс AppApi

Инкапсулирует взаимодействие с серверным API на базе класса `Api`.

**Методы:**

- `handleResponse(response: Response): Promise<any>` — возвращает `JSON` при успешном ответе либо бросает исключение;
- `get(uri: string): Promise<any>` — выполняет запрос на получение данных;
- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<any>` — выполняет отправку данных.

---

## Взаимодействие компонентов

Механизмы интеграции слоёв определены в файле **`index.ts`**, исполняющем роль презентера:

1. Инициализируются экземпляры всех необходимых классов.
2. Настраиваются обработчики событий.
3. Связь между слоями обеспечивается через публикацию и обработку событий, предоставляемых `EventEmitter`.

---

## Событийная модель

Ниже приведён перечень событий, возникающих в системе.

### События изменения данных

(генерируются моделями данных)

- `order:changed` — изменение способа оплаты и адреса пользователя;
- `contacts:changed` — изменение контактных данных пользователя;
- `cards:changed` — изменение состава карточек в корзине.

### События пользовательского интерфейса

(генерируются классами слоя представления)

- `order:open` — открытие модального окна редактирования оплаты и адреса;
- `contacts:open` — открытие модального окна контактных данных;
- `card:open` — открытие модального окна карточки товара;
- `basket:open` — открытие модального окна корзины;
- `success-payment:open` — открытие окна уведомления об успешной оплате;
- `card:select` — выбор карточки для отображения в модальном окне;
- `card-basket:register` — нажатие кнопки «оформить» в корзине;
- `order:register` — нажатие кнопки «далее» в форме оплаты и адреса;
- `contacts:register` — нажатие кнопки «оплатить» в форме контактных данных;
- `card-basket:delete` — удаление карточки из корзины;
- `order:validation` — валидация формы оплаты и адреса;
- `contacts:validation` — валидация формы контактных данных;
- `payment:edit` — изменение состояния выбора способа оплаты;
- `order:input` — изменение данных формы оплаты и адреса;
- `contacts:input` — изменение данных формы контактных данных;
- `order:submit` — сохранение способа оплаты и адреса из модального окна;
- `contacts:submit` — сохранение контактных данных из модального окна;
- `new-card:edit` — добавление товара в корзину;
- `basket:clear` — очистка корзины после успешной покупки;
- `contacts:clear` — очистка контактных данных в модальном окне;
- `order:clear` — очистка данных о способе оплаты и адресе пользователя.
